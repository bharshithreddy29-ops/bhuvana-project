{% extends "layout.html" %}

{% block title %}Price Alerts{% endblock %}

{% block content %}
<section class="alerts-section">
    <div class="container">
        <h2>Price Alerts</h2>
        <p>Set up notifications when product prices drop below your threshold.</p>

        <form class="alert-form" action="{{ url_for('alerts') }}" method="post">
            <input type="text" name="product_name" placeholder="Product name" required>
            <input type="email" name="email" placeholder="Email (optional)">

            <div style="display: flex; gap: 1rem; align-items: center;">
                <select name="condition" style="padding: 0.8rem; border: 1px solid #ddd; border-radius: 4px; flex: 1;">
                    <option value="below">▼ Alert when drops below</option>
                    <option value="above">▲ Alert when rises above</option>
                </select>
                <input type="number" name="threshold" placeholder="Price (₹)" step="0.01" required style="flex: 2;">
            </div>

            <button type="submit" class="btn-primary" style="margin-top: 1rem; width: 100%;">Set Alert</button>
        </form>

        {% if alerts %}
        <h3>Your Alerts</h3>
        <ul class="alert-list">
            {% for alert in alerts %}
            <li class="alert-item">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>{{ alert.product_name }}</strong> <br>
                        {% if alert.condition == 'above' %}
                        <span style="color: #e74c3c;">▲ Alert when price rises above ₹{{ "%.2f"|format(alert.threshold)
                            }}</span>
                        {% else %}
                        <span style="color: #27ae60;">▼ Alert when price drops below ₹{{ "%.2f"|format(alert.threshold)
                            }}</span>
                        {% endif %}
                        {% if alert.email %}<br><small style="color: #7f8c8d;">Email: {{ alert.email }}</small>{% endif
                        %}
                    </div>

                    <form action="{{ url_for('alerts') }}" method="post" style="margin: 0;">
                        <input type="hidden" name="delete_alert_id" value="{{ alert.id }}">
                        <button type="submit" class="btn-danger">Delete</button>
                    </form>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>No alerts set up yet.</p>
        {% endif %}
    </div>
</section>
{% endblock %}